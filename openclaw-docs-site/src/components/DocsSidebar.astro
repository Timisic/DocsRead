---
// src/components/DocsSidebar.astro
import { getCollection } from 'astro:content';

const { currentPath } = Astro.props;
const docs = await getCollection('docs');

// Sort docs by filename to maintain order (01-, 02-, etc.)
const sortedDocs = docs
  .filter(doc => doc.id.startsWith('modules/'))
  .sort((a, b) => {
    const aNum = parseInt(a.id.match(/modules\/(\d+)/)?.[1] || '999');
    const bNum = parseInt(b.id.match(/modules\/(\d+)/)?.[1] || '999');
    return aNum - bNum;
  });

// Get document titles or fallback to filename
const getDocTitle = (doc) => {
  if (doc.data.title) return doc.data.title;
  const filename = doc.id.replace('modules/', '');
  const titleMap = {
    '01-installation': '安装与部署',
    '02-soul-config': 'SOUL.md 配置',
    '03-channel-config': '聊天平台配置',
    '04-core-principles': '核心原则：查阅 Docs',
    '05-scenario-news': '场景一：自动化论文推送',
    '06-scenario-coding': '场景二：远程代码编写',
    '08-config-management': '配置管理与维护',
    '09-faq': '常见问题'
  };
  return titleMap[filename] || filename.replace(/-/g, ' ');
};
---

<aside class="sidebar">
  <h2>OpenClaw 使用指南</h2>
  <nav>
    <ul>
      <li>
        <a
          href="/"
          class:list={["block", { "active": currentPath === "/" }]}
        >
          首页
        </a>
      </li>
      {sortedDocs.map(doc => {
        const href = `/modules/${doc.id.replace('modules/', '')}`;
        const isActive = currentPath === href ||
                         (currentPath === '/' && href === '/modules/01-installation');
        return (
          <li>
            <a
              href={href}
              class:list={["block", { "active": isActive }]}
            >
              {getDocTitle(doc)}
            </a>
          </li>
        );
      })}
    </ul>
  </nav>
</aside>