---
// src/layouts/DocPage.astro
import DocsLayout from './DocsLayout.astro';
import DocsSidebar from '../components/DocsSidebar.astro';

const { title, description } = Astro.props;
const currentPath = Astro.url.pathname;
---

<style>
  /* ====================================================
     Reset Tailwind Typography's opinionated pre/code styles
     ==================================================== */

  /* Strip all Typography plugin styles from pre inside .prose */
  :global(.prose pre) {
    margin: 0 !important;
    padding: 0 !important;
    background: transparent !important;
    border-radius: 0 !important;
    border: none !important;
    font-size: inherit !important;
    line-height: inherit !important;
    color: inherit !important;
    overflow: visible !important;
    box-shadow: none !important;
  }

  /* Remove backtick decorators on inline code from Typography */
  :global(.prose code::before),
  :global(.prose code::after) {
    content: none !important;
  }

  /* Inline code - GitHub light style */
  :global(.prose :not(pre) > code) {
    background-color: rgba(175, 184, 193, 0.2) !important;
    color: #24292f !important;
    padding: 0.2em 0.4em !important;
    border-radius: 6px !important;
    font-size: 85% !important;
    font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace !important;
    font-weight: 400 !important;
    border: none !important;
  }

  /* ====================================================
     Code block wrapper (.code-block added by rehype plugin)
     ==================================================== */
  :global(.code-block) {
    position: relative;
    margin: 1rem 0 1.5rem 0;
    border-radius: 6px;
    border: 1px solid #30363d;
    overflow: hidden;
    background: #0d1117;
  }

  /* The <pre> generated by rehype-pretty-code / Shiki */
  :global(.code-block pre) {
    margin: 0 !important;
    padding: 1rem !important;
    padding-right: 3rem !important;
    overflow-x: auto !important;
    background: transparent !important;
    border: none !important;
    border-radius: 0 !important;
    font-size: 13.6px !important;
    line-height: 1.65 !important;
    color: #e6edf3 !important;
    box-shadow: none !important;
  }

  /* <code> inside a block */
  :global(.code-block pre code) {
    display: grid;
    font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
    font-size: inherit;
    line-height: inherit;
    color: inherit;
    background: transparent;
    padding: 0;
    border: none;
    border-radius: 0;
    white-space: pre;
  }

  /* Each .line span produced by rehype-pretty-code */
  :global(.code-block .line) {
    display: inline-block;
    min-height: 1rem;
    min-width: 100%;
  }

  /* Highlighted line */
  :global(.code-block .line--highlighted) {
    background: rgba(56, 139, 253, 0.15);
    margin: 0 -1rem;
    padding: 0 1rem;
  }

  /* ====================================================
     Copy button - appears on hover
     ==================================================== */
  :global(.copy-btn) {
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px;
    background: rgba(255, 255, 255, 0.07);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s ease;
    opacity: 0;
    pointer-events: none;
  }

  :global(.code-block:hover .copy-btn) {
    opacity: 1;
    pointer-events: auto;
  }

  :global(.copy-btn:hover) {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.2);
  }

  :global(.copy-btn svg) {
    width: 14px;
    height: 14px;
    fill: #8b949e;
    transition: fill 0.15s ease;
  }

  :global(.copy-btn:hover svg) {
    fill: #e6edf3;
  }

  :global(.copy-btn.copied svg) {
    fill: #3fb950;
  }

  /* ====================================================
     GitHub-style blockquote
     ==================================================== */
  :global(.prose blockquote) {
    border-left: 4px solid #d0d7de !important;
    color: #57606a !important;
    padding-left: 1em !important;
    margin-left: 0 !important;
    font-style: normal !important;
    background: transparent !important;
  }

  :global(.prose blockquote p) {
    margin: 0 !important;
  }

  /* ====================================================
     GitHub-style tables
     ==================================================== */
  :global(.prose table) {
    border-collapse: collapse !important;
    width: 100% !important;
  }

  :global(.prose table th),
  :global(.prose table td) {
    border: 1px solid #d0d7de !important;
    padding: 6px 13px !important;
  }

  :global(.prose table tr:nth-child(even)) {
    background-color: #f6f8fa !important;
  }

  :global(.prose table th) {
    background-color: #f6f8fa !important;
    font-weight: 600 !important;
  }

  /* ====================================================
     GitHub-style horizontal rule
     ==================================================== */
  :global(.prose hr) {
    border-color: #d0d7de !important;
    margin: 2rem 0 !important;
  }
</style>

<DocsLayout title={title} description={description}>
  <div class="min-h-screen">
    <!-- Desktop sidebar -->
    <div class="hidden md:block fixed top-0 left-0 h-full z-10">
      <DocsSidebar currentPath={currentPath} />
    </div>

    <!-- Mobile sidebar toggle -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-20">
      <div class="flex items-center justify-between p-4">
        <h1 class="text-lg font-semibold">OpenClaw 使用指南</h1>
        <button id="mobile-menu-toggle" class="p-2 rounded-md hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile sidebar -->
    <div id="mobile-sidebar" class="md:hidden fixed inset-y-0 left-0 w-64 bg-white border-r border-gray-200 transform -translate-x-full transition-transform duration-300 ease-in-out z-30">
      <div class="p-4 border-b border-gray-200">
        <button id="mobile-menu-close" class="p-2 rounded-md hover:bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <DocsSidebar currentPath={currentPath} />
    </div>

    <!-- Mobile overlay -->
    <div id="mobile-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-50 hidden z-25"></div>

    <!-- Main content -->
    <main class="prose prose-gray max-w-none md:ml-[280px] ml-0 md:mt-0 mt-16 p-8 md:p-12">
      <slot />
    </main>
  </div>

  <script>
    // Mobile menu
    document.addEventListener('DOMContentLoaded', () => {
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenuClose = document.getElementById('mobile-menu-close');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const mobileOverlay = document.getElementById('mobile-overlay');

      mobileMenuToggle?.addEventListener('click', () => {
        mobileSidebar?.classList.remove('-translate-x-full');
        mobileOverlay?.classList.remove('hidden');
      });

      mobileMenuClose?.addEventListener('click', () => {
        mobileSidebar?.classList.add('-translate-x-full');
        mobileOverlay?.classList.add('hidden');
      });

      mobileOverlay?.addEventListener('click', () => {
        mobileSidebar?.classList.add('-translate-x-full');
        mobileOverlay?.classList.add('hidden');
      });
    });

    // Copy code
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.code-block').forEach((block) => {
        const copyBtn = block.querySelector('.copy-btn');
        const pre = block.querySelector('pre');

        if (!copyBtn || !pre) return;

        copyBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          e.stopPropagation();

          // Prefer per-line spans; fall back to innerText
          const lines = pre.querySelectorAll('.line');
          const codeText = lines.length > 0
            ? Array.from(lines).map((l) => l.textContent ?? '').join('\n').trimEnd()
            : (pre.querySelector('code')?.innerText ?? pre.innerText).trim();

          try {
            await navigator.clipboard.writeText(codeText);
          } catch {
            const ta = document.createElement('textarea');
            ta.value = codeText;
            ta.style.cssText = 'position:fixed;left:-9999px;';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
          }

          copyBtn.classList.add('copied');
          setTimeout(() => copyBtn.classList.remove('copied'), 1500);
        });
      });
    });
  </script>
</DocsLayout>
